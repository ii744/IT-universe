<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–±—Ä—ñ–π</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Marck+Script&family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Comfortaa', cursive;
            background-color: #121212;
            color: #E0E0E0;
            overflow-x: hidden;
        }
        .logo {
            font-family: 'Marck Script', cursive;
            font-size: 3rem;
            color: #FFFFFF;
        }
        .handwritten {
            font-family: 'Comfortaa', cursive;
        }
        .screen {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            min-height: 100vh;
            width: 100%;
        }
        .screen.active {
            display: flex;
            opacity: 1;
        }
        /* Typing cursor */
        .typing-text span {
            border-right: .1em solid white;
            animation: caret 1s steps(1) infinite;
        }
        @keyframes caret { 50% { border-color: transparent; } }

        /* Chat styles */
        .message { max-width: 75%; }
        .user-message { background-color: #3B82F6; color: white; }
        .ai-message { background-color: #374151; color: white; }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content {
            background-color: #1f2937;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 500px;
            transform: scale(0.9);
            transition: transform 0.3s;
        }
        .modal-overlay.active .modal-content { transform: scale(1); }
        
        /* Flashcard flip animation */
        .flashcard { perspective: 1000px; }
        .flashcard-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; text-align: center; padding: 1rem; border-radius: 1rem; }
        .flashcard-front { background-color: #374151; }
        .flashcard-back { background-color: #4b5563; transform: rotateY(180deg); }
    </style>
</head>
<body class="bg-black text-white">

    <!-- Screen 1: Intro -->
    <div id="intro-screen" class="screen active flex-col justify-center items-center text-center p-4">
        <header class="absolute top-8">
            <h1 class="logo">–û–±—Ä—ñ–π*</h1>
        </header>
        <main class="flex flex-col items-center justify-center h-full">
            <p class="handwritten text-2xl md:text-4xl mb-12">–°—å–æ–≥–æ–¥–Ω—ñ —è —Ö–æ—á—É <span id="typing-effect" class="font-bold"></span></p>
            <button id="start-btn" class="handwritten bg-white text-black font-bold py-3 px-8 rounded-lg text-xl hover:bg-gray-200 transition-colors">–†–æ–∑–ø–æ—á–∞—Ç–∏</button>
        </main>
    </div>

    <!-- Screen 2: Tone Selection -->
    <div id="tone-screen" class="screen flex-col justify-center items-center text-center p-4">
        <header class="absolute top-8"><h1 class="logo">–û–±—Ä—ñ–π*</h1></header>
        <main class="flex flex-col items-center">
            <h2 class="handwritten text-2xl md:text-3xl mb-8">–û–±–µ—Ä—ñ—Ç—å —Ç–æ–Ω —Ä–æ–∑–º–æ–≤–∏</h2>
            <div class="border-2 border-zinc-600 rounded-2xl w-full max-w-xs sm:max-w-sm p-6 sm:p-8 flex flex-col items-center">
                <div class="flex items-center justify-between w-full">
                    <button id="prev-tone" class="text-4xl text-zinc-400 hover:text-white transition-colors">&lt;</button>
                    <div id="tone-display" class="flex flex-col items-center text-center">
                        <div id="tone-emoji" class="text-7xl sm:text-8xl mb-4"></div>
                        <h3 id="tone-name" class="font-bold text-2xl sm:text-3xl mb-2"></h3>
                    </div>
                    <button id="next-tone" class="text-4xl text-zinc-400 hover:text-white transition-colors">&gt;</button>
                </div>
                <div class="flex justify-center mt-4 space-x-2" id="tone-dots"></div>
                <p id="tone-description" class="text-zinc-400 mt-6 text-base sm:text-lg h-12"></p>
            </div>
            <button id="continue-btn" class="handwritten mt-8 bg-white text-black font-bold py-3 px-8 rounded-lg text-xl hover:bg-gray-200 transition-colors">–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏</button>
        </main>
    </div>

    <!-- Screen 3: Main Dashboard -->
    <div id="main-screen" class="screen flex-col items-center p-4 sm:p-8">
        <main class="w-full max-w-4xl mx-auto">
            <h2 class="handwritten text-3xl md:text-4xl text-center my-8">–ó –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è–º, –°–∞—à–∫–æ!</h2>
            <div class="flex flex-col sm:flex-row items-center justify-center sm:justify-start gap-4 sm:gap-8 bg-zinc-900/50 p-6 rounded-2xl mb-12">
                <div class="text-6xl border-2 border-zinc-700 rounded-full p-4">üë§</div>
                <div class="w-full text-center sm:text-left">
                    <p class="text-xl font-bold">–õ–µ–≤–µ–ª 2. –ó—ñ—Ä–æ–Ω—å–∫–∞</p>
                    <div class="w-full bg-zinc-700 rounded-full h-2.5 mt-2"><div class="bg-white h-2.5 rounded-full" style="width: 50%"></div></div>
                    <p class="text-zinc-400 text-sm mt-1">50 / 100 XP</p>
                </div>
            </div>
            <h3 class="handwritten text-2xl md:text-3xl text-center mb-8">–ë–∞–∂–∞—î—Ç–µ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏?</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <div id="new-chat-btn" class="flex flex-col items-center justify-center text-center p-6 border-2 border-zinc-700 rounded-2xl h-64 hover:bg-zinc-800 hover:border-white transition-all cursor-pointer">
                    <div class="text-4xl bg-zinc-700 rounded-full w-16 h-16 flex items-center justify-center mb-4">+</div>
                    <p class="text-xl">–í–∏–≤—á–∏—Ç–∏ –Ω–æ–≤–∏–π –º–∞—Ç–µ—Ä—ñ–∞–ª</p>
                </div>
                <!-- History cards ... -->
            </div>
        </main>
    </div>
    
    <!-- Screen 4: Chat -->
    <div id="chat-screen" class="screen flex-col h-screen p-4">
        <header class="text-center mb-4"><h1 class="logo">–û–±—Ä—ñ–π*</h1></header>
        <div id="message-container" class="flex-grow overflow-y-auto p-4 space-y-4"></div>
        <form id="chat-form" class="mt-4 flex gap-2">
            <input type="text" id="message-input" class="flex-grow bg-gray-700 rounded-full px-4 py-2 focus:outline-none" placeholder="–í–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...">
            <button type="submit" class="bg-blue-600 text-white rounded-full px-4 py-2 font-bold">‚û§</button>
        </form>
    </div>

    <!-- Test Modal -->
    <div id="test-modal" class="modal-overlay">
        <div id="test-modal-content" class="modal-content"></div>
    </div>
    
    <!-- Flashcard Modal -->
    <div id="flashcard-modal" class="modal-overlay">
         <div class="modal-content w-full h-80 max-w-md flex flex-col items-center justify-center">
            <div id="flashcard" class="flashcard w-full h-4/5">
                <div id="flashcard-inner" class="flashcard-inner">
                    <div id="flashcard-front" class="flashcard-front"></div>
                    <div id="flashcard-back" class="flashcard-back"></div>
                </div>
            </div>
            <div class="flex justify-around w-full mt-4">
                <button id="forgot-btn" class="text-red-500 font-bold py-2 px-4 rounded-lg">–ó–∞–±—É–≤</button>
                <button id="know-btn" class="text-green-500 font-bold py-2 px-4 rounded-lg">–ó–Ω–∞—é!</button>
            </div>
        </div>
    </div>


    <script>
        // --- DOM Elements ---
        const introScreen = document.getElementById('intro-screen'), toneScreen = document.getElementById('tone-screen'), mainScreen = document.getElementById('main-screen'), chatScreen = document.getElementById('chat-screen');
        const startBtn = document.getElementById('start-btn'), continueBtn = document.getElementById('continue-btn'), newChatBtn = document.getElementById('new-chat-btn');
        const typingElement = document.getElementById('typing-effect');
        const prevToneBtn = document.getElementById('prev-tone'), nextToneBtn = document.getElementById('next-tone');
        const toneEmoji = document.getElementById('tone-emoji'), toneName = document.getElementById('tone-name'), toneDescription = document.getElementById('tone-description'), toneDotsContainer = document.getElementById('tone-dots');
        const messageContainer = document.getElementById('message-container'), chatForm = document.getElementById('chat-form'), messageInput = document.getElementById('message-input');
        const testModal = document.getElementById('test-modal'), testModalContent = document.getElementById('test-modal-content');
        const flashcardModal = document.getElementById('flashcard-modal');
        
        // --- Screen Logic ---
        function showScreen(screen) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            screen.classList.add('active');
        }
        startBtn.addEventListener('click', () => showScreen(toneScreen));
        continueBtn.addEventListener('click', () => showScreen(mainScreen));
        newChatBtn.addEventListener('click', () => showScreen(chatScreen));

        // --- Typing Effect ---
        const phrases = ["—Ä–æ–∑—ñ–±—Ä–∞—Ç–∏ –≤–∏—â—É –º–∞—Ç–µ–º–∞—Ç–∏–∫—É.", "–Ω–∞–≤—á–∏—Ç–∏—Å—è –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—é.", "–≤–∏–≤—á–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –º–∏—Å—Ç–µ—Ü—Ç–≤."];
        let phraseIndex = 0, charIndex = 0, isDeleting = false;
        function type() {
            const currentPhrase = phrases[phraseIndex];
            let textToShow = '';

            if (isDeleting) {
                textToShow = currentPhrase.substring(0, charIndex - 1);
                charIndex--;
            } else {
                textToShow = currentPhrase.substring(0, charIndex + 1);
                charIndex++;
            }

            typingElement.textContent = textToShow;
            
            // Add a blinking cursor effect via a span
            if (!typingElement.querySelector('span')) {
                const cursor = document.createElement('span');
                typingElement.appendChild(cursor);
            }


            let typeSpeed = isDeleting ? 75 : 150;

            if (!isDeleting && charIndex === currentPhrase.length) {
                typeSpeed = 2000; // Pause at the end
                isDeleting = true;
            } else if (isDeleting && charIndex === 0) {
                isDeleting = false;
                phraseIndex = (phraseIndex + 1) % phrases.length;
                typeSpeed = 500; // Pause before typing new phrase
            }
            
            setTimeout(type, typeSpeed);
        }
        document.addEventListener('DOMContentLoaded', type);

        // --- Tone Selection ---
        const tones = [{ name: '–ï–ª–ª–∞', emoji: 'ü™ê', description: '–ü—Ä–∏–≤—ñ—Ç–Ω–∞, –ø–æ—è—Å–Ω–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Å—Ç–æ.' }, { name: '–°–æ–∫—Ä–∞—Ç', emoji: 'üèõÔ∏è', description: '–ú—É–¥—Ä–∏–π, —Å—Ç–∞–≤–∏—Ç—å –Ω–∞–≤—ñ–¥–Ω—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è.' }];
        let currentToneIndex = 0;
        function updateToneDisplay() {
            const tone = tones[currentToneIndex];
            toneEmoji.textContent = tone.emoji;
            toneName.textContent = tone.name;
            toneDescription.textContent = tone.description;
            updateDots();
        }

        function updateDots() {
            toneDotsContainer.innerHTML = '';
            tones.forEach((_, index) => {
                const dot = document.createElement('span');
                dot.classList.add('h-2', 'w-2', 'rounded-full', 'transition-colors');
                dot.classList.toggle('bg-white', index === currentToneIndex);
                dot.classList.toggle('bg-zinc-600', index !== currentToneIndex);
                toneDotsContainer.appendChild(dot);
            });
        }
        prevToneBtn.addEventListener('click', () => {
            currentToneIndex = (currentToneIndex - 1 + tones.length) % tones.length;
            updateToneDisplay();
        });
        nextToneBtn.addEventListener('click', () => {
            currentToneIndex = (currentToneIndex + 1) % tones.length;
            updateToneDisplay();
        });
        updateToneDisplay();

        // --- Chat Logic ---
        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const userText = messageInput.value.trim();
            if (!userText) return;

            addMessage(userText, 'user');
            messageInput.value = '';

            if (userText.toLowerCase() === '—è –≤—Å–µ –≤–∏–≤—á–∏–≤') {
                runPostChatSequence();
            } else {
                setTimeout(() => addMessage(userText, 'ai'), 500); // Echo
            }
        });

        function addMessage(text, sender, isHTML = false) {
            const messageWrapper = document.createElement('div');
            messageWrapper.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
            
            const messageEl = document.createElement('div');
            messageEl.className = `message p-3 rounded-2xl ${sender === 'user' ? 'user-message' : 'ai-message'}`;
            if (isHTML) {
                messageEl.innerHTML = text;
            } else {
                messageEl.textContent = text;
            }

            messageWrapper.appendChild(messageEl);
            messageContainer.appendChild(messageWrapper);
            messageContainer.scrollTop = messageContainer.scrollHeight;

            if (sender === 'ai' && isHTML) {
                if (messageEl.querySelector('#start-test-btn')) {
                    messageEl.querySelector('#start-test-btn').addEventListener('click', startTest);
                }
                if (messageEl.querySelector('#start-flashcards-btn')) {
                    messageEl.querySelector('#start-flashcards-btn').addEventListener('click', startFlashcards);
                }
            }
        }
        
        function runPostChatSequence() {
            setTimeout(() => addMessage("–ù–∞—à–∞ —Ä–æ–∑–º–æ–≤–∞ –±—É–ª–∞ —á—É–¥–æ–≤–æ—é!", 'ai'), 500);
            setTimeout(() => addMessage(`–ì–æ—Ç–æ–≤–∏–π –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–Ω–∞–Ω–Ω—è? <br><button id="start-test-btn" class="mt-2 bg-green-500 text-white font-bold py-2 px-4 rounded-lg">‚úÖ –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</button>`, 'ai', true), 1500);
        }

        // --- Test Logic ---
        const testQuestions = [
            { q: "–©–æ —Ç–∞–∫–µ '—Å–∏–Ω–≥—É–ª—è—Ä–Ω—ñ—Å—Ç—å' –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –ê–Ü?", a: ["–¢–æ—á–∫–∞, –¥–µ –ê–Ü —Å—Ç–∞—î —Å–∞–º–æ—Å–≤—ñ–¥–æ–º–∏–º", "–ë–∞–≥ —É –∫–æ–¥—ñ", "–¢–∏–ø –Ω–µ–π—Ä–æ–Ω–Ω–æ—ó –º–µ—Ä–µ–∂—ñ"], correct: 0, exp: "–°–∏–Ω–≥—É–ª—è—Ä–Ω—ñ—Å—Ç—å - —Ü–µ –≥—ñ–ø–æ—Ç–µ—Ç–∏—á–Ω–∞ —Ç–æ—á–∫–∞ –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É, –∫–æ–ª–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω–∏–π —Ä—ñ—Å—Ç —Å—Ç–∞—î –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏–º —ñ –Ω–µ–∑–≤–æ—Ä–æ—Ç–Ω—ñ–º, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏—Ö –∑–º—ñ–Ω —É –ª—é–¥—Å—å–∫—ñ–π —Ü–∏–≤—ñ–ª—ñ–∑–∞—Ü—ñ—ó." },
            { q: "–Ø–∫–∞ –∑ —Ü–∏—Ö –∞–∫—Ç–∏–≤–∞—Ü—ñ–π–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∞?", a: ["Sigmoid", "ReLU", "Tanh"], correct: 1, exp: "ReLU (Rectified Linear Unit) —î –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–æ—é, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ–≤–µ—Ä—Ç–∞—î 0 –¥–ª—è –Ω–µ–≥–∞—Ç–∏–≤–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å —ñ —Å–∞–º–µ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è –ø–æ–∑–∏—Ç–∏–≤–Ω–∏—Ö, —â–æ —Ä–æ–±–∏—Ç—å —ó—ó –æ–±—á–∏—Å–ª—é–≤–∞–ª—å–Ω–æ –¥—É–∂–µ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—é." },
        ];
        let currentQuestionIndex = 0;

        function startTest() {
            currentQuestionIndex = 0;
            testModal.classList.add('active');
            displayTestQuestion();
        }

        function displayTestQuestion() {
            const q = testQuestions[currentQuestionIndex];
            testModalContent.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">–¢–µ—Å—Ç</h3>
                    <p class="text-zinc-400">${currentQuestionIndex + 1}/${testQuestions.length}</p>
                </div>
                <p class="mb-6">${q.q}</p>
                <div id="answers-container" class="space-y-3">
                    ${q.a.map((answer, i) => `<button data-index="${i}" class="w-full text-left p-3 bg-gray-600 rounded-lg hover:bg-gray-500">${answer}</button>`).join('')}
                </div>
                <div id="explanation-container" class="mt-4 p-3 bg-gray-800 rounded-lg hidden"></div>
                <div class="text-right mt-4">
                    <button id="next-q-btn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hidden">–î–∞–ª—ñ</button>
                </div>
            `;
            document.querySelectorAll('#answers-container button').forEach(btn => btn.addEventListener('click', checkAnswer));
            document.getElementById('next-q-btn').addEventListener('click', nextQuestion);
        }

        function checkAnswer(e) {
            const selectedIndex = parseInt(e.target.dataset.index);
            const correctIndex = testQuestions[currentQuestionIndex].correct;
            document.querySelectorAll('#answers-container button').forEach((btn, i) => {
                btn.disabled = true;
                if (i === correctIndex) btn.classList.add('bg-green-600', 'border-2', 'border-green-400');
                else if (i === selectedIndex) btn.classList.add('bg-red-600', 'border-2', 'border-red-400');
            });
            const expContainer = document.getElementById('explanation-container');
            expContainer.textContent = testQuestions[currentQuestionIndex].exp;
            expContainer.classList.remove('hidden');
            document.getElementById('next-q-btn').classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < testQuestions.length) {
                displayTestQuestion();
            } else {
                testModal.classList.remove('active');
                setTimeout(() => addMessage("–¢–∏ –º–æ–ª–æ–¥–µ—Ü—å!", 'ai'), 500);
                setTimeout(() => addMessage(`<div class="p-2">
                    <p class="font-bold">–ê—É–¥—ñ–æ-–ø–æ–¥–∫–∞—Å—Ç: 5 —Ö–≤–∏–ª–∏–Ω –ø—Ä–æ –∫–≤–∞–Ω—Ç–æ–≤—ñ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è</p>
                    <div class="flex items-center gap-2 mt-2">
                        <div class="text-2xl">‚ñ∂Ô∏è</div>
                        <div class="w-full h-2 bg-gray-600 rounded-full flex items-center">
                            <div class="w-1/3 h-full bg-blue-500 rounded-full"></div>
                            <div class="h-4 w-4 bg-white rounded-full -ml-2"></div>
                        </div>
                        <span class="text-sm text-zinc-400">1:42</span>
                    </div>
                </div>`, 'ai', true), 1500);
                setTimeout(() => addMessage(`–ê —Ç–µ–ø–µ—Ä –∑–∞–∫—Ä—ñ–ø–∏–º–æ –º–∞—Ç–µ—Ä—ñ–∞–ª –∫–∞—Ä—Ç–∫–∞–º–∏! <br><button id="start-flashcards-btn" class="mt-2 bg-purple-500 text-white font-bold py-2 px-4 rounded-lg">üóÇÔ∏è –ü–æ—á–∞—Ç–∏</button>`, 'ai', true), 2500);
            }
        }
        
        // --- Flashcard Logic ---
        const flashcards = [
            { term: '–ù–µ–π—Ä–æ–Ω', def: '–ë–∞–∑–æ–≤–∞ –æ–±—á–∏—Å–ª—é–≤–∞–ª—å–Ω–∞ –æ–¥–∏–Ω–∏—Ü—è –≤ –Ω–µ–π—Ä–æ–Ω–Ω—ñ–π –º–µ—Ä–µ–∂—ñ.' },
            { term: '–ó–≤–æ—Ä–æ—Ç–Ω–µ –ø–æ—à–∏—Ä–µ–Ω–Ω—è –ø–æ–º–∏–ª–∫–∏', def: '–ê–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –Ω–µ–π—Ä–æ–Ω–Ω–∏—Ö –º–µ—Ä–µ–∂.' },
            { term: '–ü–µ—Ä–µ–Ω–∞–≤—á–∞–Ω–Ω—è', def: '–ö–æ–ª–∏ –º–æ–¥–µ–ª—å –¥–æ–±—Ä–µ –ø—Ä–∞—Ü—é—î –Ω–∞ —Ç—Ä–µ–Ω—É–≤–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö, –∞–ª–µ –ø–æ–≥–∞–Ω–æ –Ω–∞ –Ω–æ–≤–∏—Ö.' }
        ];
        let currentCardIndex = 0;

        function startFlashcards() {
            currentCardIndex = 0;
            flashcardModal.classList.add('active');
            displayFlashcard();
        }

        function displayFlashcard() {
             const card = flashcards[currentCardIndex];
             document.getElementById('flashcard').classList.remove('flipped');
             setTimeout(() => { // delay to allow flip back animation
                document.getElementById('flashcard-front').textContent = card.term;
                document.getElementById('flashcard-back').textContent = card.def;
             }, 300);
        }

        document.getElementById('flashcard').addEventListener('click', () => document.getElementById('flashcard').classList.toggle('flipped'));
        document.getElementById('forgot-btn').addEventListener('click', nextCard);
        document.getElementById('know-btn').addEventListener('click', nextCard);

        function nextCard() {
            currentCardIndex++;
            if (currentCardIndex < flashcards.length) {
                displayFlashcard();
            } else {
                flashcardModal.classList.remove('active');
                addMessage("–ß—É–¥–æ–≤–∞ —Ä–æ–±–æ—Ç–∞! –ú–∞—Ç–µ—Ä—ñ–∞–ª –∑–∞—Å–≤–æ—î–Ω–æ.", 'ai');
            }
        }


        // --- Helper function to re-add event listeners on screen show ---
        // (This is a simplified example; a more robust app might use a different architecture)
        function reinitializeScripts() {
            // Re-attach any listeners that might be lost if elements are re-rendered
            // For now, this is simple, but can be expanded.
        }
        
        document.addEventListener('DOMContentLoaded', () => {
             // Initial type effect
            if(typingElement) {
                type();
            }
             // Initial tone display
            if(toneEmoji) {
                updateToneDisplay();
            }
        });

    </script>
</body>
</html>


